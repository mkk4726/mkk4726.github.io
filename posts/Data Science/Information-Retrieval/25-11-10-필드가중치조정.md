---
title: "필드 가중치 조정 (Field Boosting)"
date: "2025-11-10"
excerpt: "검색엔진에서 문서의 각 필드가 검색 점수에 미치는 영향을 조절하는 방법"
category: "Information Retrieval"
tags: ["IR"]
---

필드 가중치 조절??

> 검색엔진에서 같은 단어라도 제목에 있을 때와 본문에 있을 때 중요도가 다르다. 
> 필드 가중치 조정(Field Boosting / Field Weighting)은 문서의 각 필드가 검색 점수에 얼마나 영향을 미치게 할지 조절하는 작업이다.

문서가 있다면 거기에 대해 필드가 존재할텐데 (영화로 치면 제목, 줄거리, 등장인물 등등) 어느 필드를 더 중요하게 생각할지 정하는 작업정도로 이해할 수 있겠다.

---

## 기본 개념

검색엔진(Elasticsearch, Lucene 등)은 문서를 여러 필드로 구성해서 색인한다.

```json
{
  "title": "Machine learning introduction",
  "body": "Machine learning is a subfield of artificial intelligence...",
  "tags": ["AI", "ML", "Tutorial"]
}
```

사용자가 `"machine learning"`을 검색했을 때, 검색 점수는 각 필드별로 계산될 수 있다.

$$
\text{score} = w_{\text{title}} \cdot \text{BM25}_{\text{title}} + w_{\text{body}} \cdot \text{BM25}_{\text{body}} + w_{\text{tags}} \cdot \text{BM25}_{\text{tags}}
$$

여기서 $w_{\text{title}}, w_{\text{body}}, w_{\text{tags}}$가 필드 가중치(field weights)다.

---

## 왜 필요한가?

현실적으로 제목에 있는 키워드는 문서의 핵심 주제일 가능성이 높고, 본문(body)은 잡다한 문장이 많으며, 태그(tags)는 보조적 의미만 있을 수 있다. 그렇기 때문에 `title`에서 매칭된 경우 더 높은 점수를 주는 게 검색 품질(relevance)을 크게 올린다.

예시를 보자.

| 필드    | 매칭 단어   | 가중치(weight) | 점수 기여               |
| ----- | ------- | ----------- | ------------------- |
| title | machine | **3.0**     | 3.0 × 2.1 = **6.3** |
| body  | machine | 1.0         | 1.0 × 1.2 = **1.2** |
| tags  | machine | 2.0         | 2.0 × 1.8 = **3.6** |

최종 점수 = 6.3 + 1.2 + 3.6 = 11.1

title의 영향이 훨씬 커진다.

---

## Elasticsearch 예시

Elasticsearch에서는 `boost` 또는 `weight` 속성으로 지정한다.

```json
{
  "query": {
    "multi_match": {
      "query": "machine learning",
      "fields": ["title^3", "body^1", "tags^2"]
    }
  }
}
```

- `title^3` → title 필드 점수를 3배 가중
- `body^1` → 기본값
- `tags^2` → 태그 필드 점수를 2배 가중

---

## BM25와의 관계

각 필드의 BM25 점수 계산은 동일한 공식을 따르지만, 가중치(weight)를 곱해서 최종 점수로 합산한다.

$$
\text{score}(d, q) = \sum_{f \in \text{fields}} w_f \cdot \text{BM25}_f(q, d_f)
$$

이때 각 필드마다 `b`, `k₁` 값을 다르게 설정할 수도 있다.

| 필드    | k₁  | b   | 설명             |
| ----- | --- | --- | -------------- |
| title | 1.0 | 0.5 | 짧고 핵심적인 필드     |
| body  | 1.6 | 0.8 | 긴 본문, 길이 보정 필요 |
| tags  | 1.2 | 0.3 | 키워드만 포함        |

즉, 필드별 BM25 파라미터와 필드별 가중치를 함께 튜닝하면 훨씬 정교한 검색 랭킹이 가능하다.

---

## 언제 특히 중요한가?

| 상황          | 이유                                |
| ----------- | --------------------------------- |
| 뉴스, 블로그, 리뷰 | 제목(title)이 핵심이므로 boost 필요         |
| 쇼핑몰 상품 검색   | 브랜드명, 상품명 필드에 높은 weight           |
| 논문 검색       | abstract, title, keyword 필드 우선    |
| FAQ / QnA   | question 필드에 높은 weight, answer 낮게 |

---

## 필드별 BM25 파라미터 차별화

필드의 특성에 따라 BM25의 `k₁`과 `b` 값을 다르게 설정하는 것도 효과적이다.

**제목(title) 필드**
- 짧고 핵심적인 내용만 포함
- `k₁ = 1.0` (낮은 값): 단어 반복 효과를 덜 받음
- `b = 0.5` (낮은 값): 길이 정규화를 덜 받음 (이미 짧으니까)

**본문(body) 필드**
- 길고 다양한 내용 포함
- `k₁ = 1.6` (높은 값): 단어 반복이 의미 있을 수 있음
- `b = 0.8` (높은 값): 문서 길이에 따른 정규화 필요

**태그(tags) 필드**
- 키워드만 포함
- `k₁ = 1.2` (중간 값)
- `b = 0.3` (낮은 값): 태그는 보통 길이가 일정함

---

## 실전 튜닝 전략

필드 가중치를 어떻게 설정할지는 도메인과 데이터에 따라 다르다. 일반적인 접근 방법은 다음과 같다.

### 1단계: 기본 가중치로 시작

```json
{
  "query": {
    "multi_match": {
      "query": "machine learning",
      "fields": ["title^2", "body^1", "tags^1.5"]
    }
  }
}
```

### 2단계: 검색 품질 평가

- Precision@K: 상위 K개 결과 중 관련 문서 비율
- Recall@K: 전체 관련 문서 중 상위 K개에 포함된 비율
- NDCG (Normalized Discounted Cumulative Gain): 순위까지 고려한 평가

### 3단계: 가중치 조정

실제 검색 로그와 사용자 피드백을 바탕으로 가중치를 조정한다. 예를 들어:
- 사용자가 제목에 키워드가 있는 문서를 더 많이 클릭한다면 → title boost 증가
- 태그 매칭이 오히려 노이즈를 만든다면 → tags boost 감소

### 4단계: A/B 테스트

여러 가중치 조합을 실제 사용자에게 테스트해서 최적값을 찾는다.

---

## Python 시뮬레이션 예제

필드 가중치에 따라 검색 결과가 어떻게 달라지는지 간단한 예제로 확인해보자.

```python
import math

def bm25_score(tf, df, N, doc_len, avg_doc_len, k1=1.5, b=0.75):
    """단일 필드에 대한 BM25 점수 계산"""
    idf = math.log((N - df + 0.5) / (df + 0.5) + 1)
    norm = 1 - b + b * (doc_len / avg_doc_len)
    score = idf * (tf * (k1 + 1)) / (tf + k1 * norm)
    return score

# 예시 문서들
docs = [
    {"id": "D1", "title": "machine learning tutorial", "body": "This is a comprehensive guide to machine learning"},
    {"id": "D2", "title": "deep learning basics", "body": "Machine learning and deep learning are related fields"},
    {"id": "D3", "title": "python programming", "body": "Learn python for machine learning applications"}
]

# 쿼리: "machine learning"
query_terms = ["machine", "learning"]

# 필드별 통계 (예시)
N = 3  # 전체 문서 수

# 각 문서의 필드별 BM25 점수 계산 (간단한 예시)
# 실제로는 각 단어별로 계산해서 합산해야 함

print("=== 가중치 1:1 (title^1, body^1) ===")
for doc in docs:
    # 간단한 예시 점수 (실제 계산은 더 복잡)
    title_score = 2.5 if "machine" in doc["title"] and "learning" in doc["title"] else 0
    body_score = 1.8 if "machine" in doc["body"] and "learning" in doc["body"] else 0
    
    total_score = 1.0 * title_score + 1.0 * body_score
    print(f"{doc['id']}: title={title_score:.2f}, body={body_score:.2f}, total={total_score:.2f}")

print("\n=== 가중치 3:1 (title^3, body^1) ===")
for doc in docs:
    title_score = 2.5 if "machine" in doc["title"] and "learning" in doc["title"] else 0
    body_score = 1.8 if "machine" in doc["body"] and "learning" in doc["body"] else 0
    
    total_score = 3.0 * title_score + 1.0 * body_score
    print(f"{doc['id']}: title={title_score:.2f}, body={body_score:.2f}, total={total_score:.2f}")
```

실행 결과:

```
=== 가중치 1:1 (title^1, body^1) ===
D1: title=2.50, body=1.80, total=4.30
D2: title=0.00, body=1.80, total=1.80
D3: title=0.00, body=1.80, total=1.80

=== 가중치 3:1 (title^3, body^1) ===
D1: title=2.50, body=1.80, total=9.30
D2: title=0.00, body=1.80, total=1.80
D3: title=0.00, body=1.80, total=1.80
```

D1 문서는 제목에 쿼리 단어가 모두 포함되어 있어서, 가중치를 3:1로 조정하면 점수 차이가 더 벌어진다. 이렇게 필드 가중치를 조정하면 제목에 키워드가 있는 문서를 훨씬 상위에 노출시킬 수 있다.

---

## Semantic Search와의 비교

필드 가중치 조정은 BM25 같은 lexical search에서 특히 효과적이다. 반면 semantic search(embedding 기반)에서는 필드별 가중치 조절이 어렵다.

| 특징 | BM25 + Field Boosting | Semantic Search |
|-----|----------------------|-----------------|
| **필드별 가중치** | 쉽게 조절 가능 (`title^3`) | 어려움 (embedding이 섞임) |
| **설명 가능성** | 높음 (어느 필드에서 매칭됐는지 명확) | 낮음 (벡터 유사도만 나옴) |
| **통제성** | 높음 (파라미터로 fine-tuning) | 낮음 (모델 의존적) |
| **의미 이해** | 없음 (단어 일치만) | 있음 (동의어, 문맥 이해) |

실전에서는 BM25의 필드 가중치 조정과 semantic search를 결합한 hybrid search를 많이 사용한다.

---

## 요약

| 항목               | 설명                                |
| ---------------- | --------------------------------- |
| 개념               | 필드별 점수 기여도를 조절                    |
| 목적               | 중요한 필드의 매칭 결과를 더 강하게 반영           |
| 구현               | `score = Σ wᵢ × BM25ᵢ`            |
| Elasticsearch 문법 | `"fields": ["title^3", "body^1"]` |
| 효과               | 검색 품질 향상, 오탐/누락 감소                |
| 한계               | Semantic search에서는 적용 어려움         |

필드 가중치 조정은 검색 품질을 높이는 가장 간단하면서도 효과적인 방법 중 하나다. 특히 제목, 본문, 태그 등 명확한 구조가 있는 문서에서는 필수적으로 고려해야 할 요소다.

