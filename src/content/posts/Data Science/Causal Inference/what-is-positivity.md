---
title: "Positivity(양수성)이란? Overlap assumption이란?"
date: "2025-08-29"
excerpt: "양수성이란? 분포의 겹침이 의미하는건?"
category: "Causal Inference"
tags: ["Positivity", "Overlap assumption"]
---

positivity 혹은 overlap assumption은 인과추론의 기본적인 가정들 중 하나입니다.
이러한 가정들은 왜 존재하는지 어떤 의미를 가지는지에 대해 정리했습니다.

- [인과추론의 기본적인 가정들](https://www.stats.ox.ac.uk/~evans/APTS/causassmp.html)

---

# 1. 처치효과를 구하는 기본적인 아이디어

처치효과란 말 그대로 "처치(Treatment)"가 결과에 미치는 영향을 의미합니다.
처치효과를 구하는 가장 단순한 아이디어는 처치를 받은 상태와 아닌 상태를 비교하는 것입니다.

<figure>
<img src="/post/Causal_Inference/처치효과_예시1.png" alt="RCT" width="60%" />
<figcaption>그림1. 처치효과를 구하는 단순한 아이디어</figcaption>
</figure>

물이 피부에 미치는 효과를 알고 싶을 때 다음처럼 생각해볼 수 있습니다.
- 그림1의 1번처럼 내가 물을 많이 마셨을 때의 피부와 아닐 때의 피부를 비교해본다.
- 또는 나는 물을 많이 마시고 친구는 많이 안마시니까 둘의 피부를 비교해본다.

하지만 이러한 방법을 통해 처치효과를 추정하긴 어렵습니다. 
왜냐하면 처치효과(마시는 물의 양)외에도 다른 요인들이 피부에 영향을 주기 때문입니다.


---

# 2. RCT (Randomized Controlled Trial) - 양수성 (Positivity)

- [참고하기 좋은 자료](https://matheusfacure.github.io/python-causality-handbook/02-Randomised-Experiments.html)

이러한 문제들을 RCT (무작위 배정 실험)을 통해 극복할 수 있습니다.

<figure>
<img src="/post/Causal_Inference/Positivity/RCT.png" alt="RCT" width="80%" />
<figcaption>그림2. RCT, 무작위 배정 실험</figcaption>
</figure>

RCT는 실험 대상자를 통제 집단과 종속 집단에 무작위로 배정하고, 집단 간의 결과 차이를 통해 처치의 효과를 추정하는 방식입니다.
- 통제집단 (Control Group): 처치를 받지 않는 집단으로, 비교의 기준이 되는 집단
- 종속집단 (Treatment Group): 처치를 받는 집단으로, 처치의 효과를 측정하고자 하는 집단

그림1에서의 실험과 차이점은 "통제"집단이 존재한다는 것입니다.
이는 처치를 제외하고는 다른 조건들이 비슷한, 통제된 집단을 의미합니다. 이를 통해 그림1에서의 문제를 해결할 수 있습니다.
> 정확히는 "무작위 배정"을 통해 해결되었다고 "가정"할 수 있습니다.

통제집단을 설정한다는 의미는 실제로 종속집단과 동일하게 조건들을 "통제"한다는 의미가 아닙니다.
모든 조건을 통제할 수 없습니다.

대신 **무작위 배정(Randomization)** 을 통해 통계적으로 균형을 맞춥니다.
무작위 배정이란 실험 대상자들을 통제집단과 종속집단에 완전히 무작위로 배정하는 것을 의미합니다.

이렇게 하면:
- 처치를 제외한 다른 모든 요인들(나이, 성별, 건강상태 등)이 두 집단에 비슷한 비율로 분포하게 됩니다
- 결과적으로 두 집단 간의 차이는 오직 처치의 효과만으로 해석할 수 있게 됩니다

이것이 RCT의 핵심 아이디어입니다.
이는 분포의 겹칩 (Overlap assumption) 가정의 개념과 일치합니다.

> 즉, 두 집단 간의 분포가 겹쳐져 있다면 (처치 효과를 제외한 다른 모든 요인들이 비슷한 비율로 분포한다면), 처치효과를 추정할 수 있습니다.

이것이 바로 **양수성(Positivity)** 또는 **Overlap assumption**의 핵심 개념입니다.

양수성은 다음과 같이 정의됩니다:

$$0 < P(T=1|X=x) < 1$$

이는 특정 공변량 값 $X=x$가 주어졌을 때, 처치를 받을 확률이 0과 1 사이에 있어야 한다는 의미입니다.

- $P(T=1|X=x) = 0$: 특정 조건에서는 절대 처치를 받지 않음
- $P(T=1|X=x) = 1$: 특정 조건에서는 항상 처치를 받음
- $0 < P(T=1|X=x) < 1$: 특정 조건에서도 처치를 받을 수도, 받지 않을 수도 있음

RCT에서는 무작위 배정을 통해 자연스럽게 양수성이 충족됩니다. 모든 사람이 동일한 확률로 처치·비처치 집단에 들어갈 수 있기 때문입니다.

---

# 3. 예측 문제에서 양수성 개념

양수성이 보장된다는 건, 모든 사람이 비슷한 확률로 처치 집단에 들어갈 수 있다는 것을 의미합니다.
이는 A라는 사람이 처치집단에 존재한다면, A와 비슷한 사람이 비처치 집단에 존재한다는 말과 같습니다.

> 즉 양수성이 보장된다면 실제 결과가 없더라도 이를 간접적으로 평가할 수 있습니다.

<figure>
<img src="/post/Causal_Inference/선택문제_평가_고민.png" alt="평가고민" width="80%" />
<figcaption>그림3. 간접적인 평가방식</figcaption>
</figure>

회사에서 풀고 있는 문제는, 렌즈 사이즈 추천 문제입니다.
고객이 시력교정을 위해 렌즈 수술을 할 때에 적절한 렌즈 크기를 결정하는게 굉장히 중요한데, 이때 선택에 도움을 주는 서비스를 만들고 있습니다.

> 이 상황에서 고민하는 문제는 "여러 선택지 중 하나에 대한 결과만 얻을 수 있다"는 것입니다.

선택할 수 있는 렌즈 사이즈가 3개라면, 고객은 1개의 렌즈 크기에 대해서만 수술을 받기 때문에, 3개의 예측 결과가 정확한지 평가할 수 없다는 것입니다.
이때 양수성의 개념을 사용해서 "간접적으로" 평가할 수 있다는 사실을 확인할 수 있습니다.

> 처치의 분포가 겹친다면, 간접적으로 평가할 수 있다.

왜냐하면 나는 A라는 수술을 받았지만, 나와 비슷한 사람은 B라는 수술을 받았을 것이기 때문입니다.
따라서 내가 B라는 수술을 받았을 때의 결과는 알 수 없지만, 비슷한 사람을 통해 B라는 수술을 받았을 때의 예측 결과를 간접적으로 알 수 있고, 
이를 통해 모델을 간접적으로 평가할 수 있습니다.

<figure>
<img src="/post/Causal_Inference/Positivity/overlap.png" alt="분포가 겹칠 때" width="80%" />
<figcaption>그림4. 분포가 겹칠 때의 상황</figcaption>
</figure>

그림4처럼 처치 간의 분포가 겹칠 때는 모델의 성능을 간접적으로 평가할 수 있고 추론 결과를 신뢰할 수 있습니다.

<figure>
<img src="/post/Causal_Inference/Positivity/no-overlap.png" alt="평가고민" width="80%" />
<figcaption>그림5. 분포가 겹치지 않을 때</figcaption>
</figure>

하지만 그림5처럼 처치 간의 분포가 겹치지 않을 때는 간접적으로 평가할 수 없습니다.
즉 T=0인 사람에 대해 T=1에 대한 결과를 추론 결과를 신뢰할 수 없습니다.

처치 간에 분포가 완전히 다른 상황에서는 성능이 보장되지 않은 완전한 "외삽" 문제가 됩니다.

---

# 4. 관찰 연구에서의 양수성 문제

관찰 연구 (RCT처럼 통제된 연구가 아닌 자연스럽게 수집된 데이터로 진행하는 연구) 에서는 양수성이 깨지기 쉽습니다.
왜냐하면 "무작위"로 처치가 배정되지 않기 때문입니다.

<figure>
<img src="/post/what-is-statistical-bias/처치별분포_피처이름제거.png" alt="평가고민" width="100%" />
<figcaption>그림6. 처치 간의 분포 차이</figcaption>
</figure>

의사는 환자의 조건을 보고 처치를 배정하고, 따라서 처치별로 분포가 다르게 형성된 것을 확인할 수 있습니다.
그림 6에서 feature1 (눈의 가로 크기)에 대한 처치 분포를 살펴보면, 분포 간에 차이가 보이는 것을 확인할 수 있습니다.

이러한 집단간의 차이를 편향이라고 하고, 실제 관측 데이터에 편향이 존재하는 것을 확인할 수 있습니다.
- [데이터에 존재하는 통계적 편향](/posts/Data%20Science/Causal%20Inference/Industry%20Application/what-is-statistical-bias)


즉, 양수성이 보장되지 않는 상황에서는 단순히 예측 평가지표만을 보는 것은 한계가 있습니다.
왜냐하면 "간접적인" 평가가 안된 추론 결과이기 때문입니다.

직관적으로 생각해보면, 그림 6에서 보이는 데이터로 학습한 모델은 그림 5의 상황과 같습니다.

feature1 (눈의 가로 크기)가 12.5 이하인 환자의 경우 13.2로 처치받은 데이터가 없습니다.
이때 이런 환자가 13.2를 처치 받았을 때의 추정값은 신뢰하기 어렵습니다.
완전한 "외삽" 문제이기 때문입니다.

---

# 5. 정리

선택의 문제에서 선택되지 않은 나머지에 대한 예측값을 간접적으로 평가할 수 있는 방법을 양수성으로 이해할 수 있습니다.
양수성이 보장된다 -> 비슷한 사람이 다른 집단에 존재한다. -> 간접적인 성능평가 가능

무작위 배정은 양수성을 자연스럽게 충족시키는 방법이고, 관찰 연구에서는 양수성이 위배될 수 있음을 확인했습니다.

양수성이 위배될 때는 선택의 문제에 예측 평가지표만을 신뢰하면 문제가 생길 수 있습니다.
완전한 "외삽"문제이기 때문에 평가지표로 확인한 성능이 전혀 보장이 안되기 때문입니다.