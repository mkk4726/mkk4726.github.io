---
title: "피처 엔지니어링에 대해서"
date: "2025-09-16"
excerpt: "feature 를 다룰 때 생각하면 좋은 내용들"
category: "Engineering"
tags: ["MLOps", "System Design", "Designing Machine Learning Systems"]
---

> 오늘날 ML 시스템의 성공은 여전히 피처에 달려 있습니다.
> 따라서 프로덕션 환경에서 ML을 사용하려면 피처 엔지니어링에 시간과 노력을 투자해야 하죠

[ML서비스를 개발하고 운영하면서](/posts/Self_Development/Career/Portfolio/visuworks_lenze_size_rec.md) ML 시스템을 더 잘 구축하기 위해 공부하고 반영하고 있습니다.

그 중에서 feature store를 구축할 때 생각하면 좋은 내용들을 정리합니다.

## 데이터는 무작위로 분할하는 대신 시간별로 학습, 검증, 테스트 분할로 분할합니다.

train/valid/test로 데이터셋을 나눠 모델의 일반화 성능을 확인합니다.
이때 가장 중요한 부분은 모델이 실제 추론 상황에서도 좋은 성능을 보일 것인지에 대한 것입니다.

이러기 위해서는 실제 추론 상황과 같은 test set을 구축해서, 일반화 성능을 확인헤야합니다.
이때 가장 좋은 방법이 시간 순대로 나누는 것입니다.

일종의 시뮬레이션처럼, 미래 (추론 상황)의 데이터를 모른다고 생각하고 모델을 만들고 검증하는 것입니다.
이를 통해 추론상황에서 발생할 수 있는 시간에 따른 data drift와 같은 문제들을 확인해볼 수도 있습니다.

## data leakage를 조심하자!

1. 오버 셈플링은 분할 후에 수행합니다
2. 데이터 누수를 방지하기 위해 스케일링과 정규화는 데이터 분할 후에 수행합니다.
3. 피처 스케일링하고 결측값을 처리할 때는 전체 데이터 대신 훈련 분할의 통계치만 사용합니다.

특정 레이블의 개수가 부족할 때 데이터의 개수를 늘리는 오버샘플링 방법을 사용하곤 합니다.
이때 가장 주의해야하는 부분이 역시나 "data leakage"입니다.
일반화 성능을 정확히 확인하지 못하게 만드는 문제입니다.

따라서 오버샘플링은 학습 상황에서 진행해야하며, 성능은 실제 추론상황이라고 가정한 test set에서 온전히 수행해야 합니다.

## 데이터 생성, 수집, 처리 방식을 이해합니다. 가능하면 도메인 전문가를 참여시키세요.

- 데이터 계보 (lineage)를 추적합니다.

전체 과정 중 데이터를 이해하는게 가장 중요하다고 생각합니다.
마치 형사가 범인을 쫒듯이, 하나씩 단서를 모아가며 데이터를 온전히 이해하려는 노력이 필요합니다.

값이 튀는게 있다면 어디서 잘못된 건지, 실제로 유의미한 범위의 데이터는 어떤건지, 어떻게 생성되고 수집되는 건지 등을 알아야 데이터를 올바르게 처리할 수 있습니다.

## 적절한, 좋은 피처만을 사용하기!

- 모델에 대한 피처 중요도를 이해합니다.
- **잘 일반화되는 피처를 사용합니다.** : 이 부분을 가장 깊게 고민해보면 좋을 것 같습니다.
- 모델에서 더 이상 유용하지 않은 피처를 제거합니다.

데이터로부터 피처를 만들고 이를 통해 정답을 예측하는 모델을 만들게 됩니다.
이때 피처를 어떻게 구성해야할지 고민하게 됩니다.

기본적인 피처를 만들다가 하나씩 추가하게 됩니다.
성능을 높이기 위해 이런저런 피처를 추가해보면서 고도화해나갑니다.

이때 고민해보면 좋은 점이 있습니다.

1. 피처가 많다고 좋은게 아니다 (당연하게도...)

피처가 많게 되면 latency가 증가하게 됩니다.
또한 일반화되지 않는 피처라면 일반화 성능을 해치게 됩니다.

예를 들면 "요일"에 대한 피처가 있을 때 학습셋에서는 "월~금"만 있고, 테스트셋에는 "토일"만 있다면 이 피처는 일반화 성능을 해치게 될 것입니다.

2. 불필요한 피처들은 제거하자

SHAP이나 feature importance score를 통해 중요한 피처를 유추해볼 수 있습니다.
중요도가 낮은 피처는 제거하는 것이 latency를 줄이고 일반화 성능에 도움이 될 수 있습니다.


