---
title: "[Visuworks] Segmentation Model"
date: ""
excerpt: "출혈관련 병변 탐지 모델 개발"
category: "Career"
tags: ["Computer Vision", "Segmentation"]
---

- 기간 : 2024.04 ~ 2024.06 (3개월)
- 역할 : 출혈 관련 병변 탐지를 위한 segmentation model 개발 및 모델 서빙, 모델 추론 관련 API 개발

---

# 프로젝트 개요

눈의 안쪽 사진인 안저사진을 통해 눈의 질병들을 진단할 수 있습니다.
이때 질병들의 증상인 병변들을 눈으로 확인하는 과정이 꽤나 번거로웠기 때문에, 이를 모델을 통해 찾아서 보여주고자 했습니다.
여러가지 탐지 중에 출혈과 관련된 병변을 탐지하는 모델을 맡아 개발을 진행했습니다.
Aiffel에서 했던 프로젝트의 결과(기본적인 Segmentation 모델 개발, 전처리 방법 고도화, MTL)를 고도화하는 방향으로 진행했습니다. 

모델 개발 후에는 온프레미스로 GPU에 모델을 서빙하고 관련된 API를 개발하는 부분도 같이 진행했습니다.

프로젝트를 진행하면서 contrastive learning을 통한 pretraining 방법을 이해할 수 있었고, Triton Server와 같은 모델 서빙 도구를 활용하여 실제 서빙 환경에서의 경험을 쌓을 수 있었습니다.

하지만 한계도 분명한 프로젝트였습니다. 일반화하긴 어렵겠지만 의료분야에 기술 도입의 어려움을 알 수 있었고, 진로에 대한 생각이 바뀌게 된 계기이기도 합니다.

---

# 문제해결과정

프로젝트를 진행하면서 고민했던 부분은 2가지인데요.
1. 모델의 성능을 어떻게 올릴까?
2. 모델 서빙은 어떻게 하는걸까?

각각 어떻게 해결해나갔는지 간단하게 정리해봤습니다.
그리고 프로젝트가 끝나면서 어떤 한계점을 마주했는지도 정리했습니다.

---

# 모델 성능을 올리기 위해서 시도했던 것들

모델의 성능을 올리기 위해 시도한 방향은 비지도 학습을 통해 사전학습을 시키는 것입니다.

데이터셋이 약 1500개정도로 적었고, 문제의 특성상 데이터셋 안에서 레이블이 있는 경우가 80%, 있어도 이미지에서 차지하는 비율은 매우 작았습니다.
하지만 안저사진 자체는 1만개 이상으로 굉장히 많았고, 이를 활용해 성능을 향상시키고자 했습니다.

CLIP과 같은 모델이 contrastive learning을 통해 좋은 결과를 보이고 있었고, 이를 이미지 분야에서도 적용하는 SimCLR 같은 컨셉이 있었습니다.
또한 병변탐지 모델에도 이를 적용한 논문들이 있었기 때문에 이를 적용해 성능을 향상시키고자 했습니다.

1년이 지난 시점에서 적어서 구체적인 수치가 기억은 안나지만, 결과적으로 성능향상이 되었던 걸로 기억합니다.
그 과정에서 시행착오가 많았지만, 논문을 보고 구현했던 경험이 실력을 향상시키는데 정말 많은 도움이 되었습니다.

---

## 모델 선택: U-Net 기반

모델은 Aiffel 프로젝트를 진행하면서 얻은 결과를 바탕으로 사용했습니다.
이때 실험결과를 통해, 많은 의료 논문에서 Unet이 작은 병변을 탐지하는데 유리하다고 했던 부분을 확인할 수 있었고, CLAHE와 같은 이미지 전처리 방법을 고도화했습니다.

Unet 구조로 모델을 설계하고, Encoder를 풍부하게 하기 위한 방법들을 적용하려고 했습니다.
이를 위해 Contrastive Learning (이후 CL)이나 Multi-Task Learning(이후 MTL) 등을 적용했습니다.

---

## Contrastive Learning 기반 사전학습

성능을 향상시키기 위해 일반화된 패턴을 먼저 학습시키는, pretraining 방법을 사용하려고 했습니다.

먼저 많이 사용되는 ImageNet기반 사전학습 가중치를 사용했습니다.
하지만 실험을 해보니 성능향상이 크게 되지 않았고, 그 이유로 안저사진이 ImageNet의 사진들과 많이 다르기 때문이라고 이해할 수 있었습니다.

따라서 안저사진 자체로 사전학습을 시도했습니다.



---

## Multi-Task Learning



---

# 모델을 서빙할 때 했던 고민들

