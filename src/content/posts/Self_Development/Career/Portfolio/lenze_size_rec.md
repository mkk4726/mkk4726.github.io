---
title: "Lens Size Recommendation System"
description: "머신러닝을 활용한 맞춤형 렌즈 사이즈 추천 시스템"
technologies: ["Python", "Machine Learning", "Causal Inference", "Flask", "BentoML"]
github: "https://github.com/mkk4726/lens-size-rec"
demo: "https://lens-rec-demo.example.com"
date: "2024-11-15"
---

# 정의했던 문제들, 해결하는 과정, 해결한 결과










# 프로젝트 설명

## 프로젝트 개요
시력교정센터에서 렌즈 삽입술을 위한 최적의 렌즈 크기를 추천하는 머신러닝 기반 시스템을 개발했습니다. 의사의 경험과 노하우에 의존하던 렌즈 선택 과정을 데이터 기반으로 객관화하여, 환자별 맞춤형 렌즈 사이즈를 추천하는 서비스를 제공합니다.

## 주요 기능
- **예측 모델**: 환자 정보와 렌즈 크기를 입력받아 수술 결과(Vault) 예측
- **인과추론 기반**: 통계적 편향을 제거한 신뢰할 수 있는 예측 제공
- **의학적 직관 반영**: 단조 증가/감소 조건을 만족하는 모델 설계
- **해석 가능성**: 예측 결과에 대한 근거와 설명 제공
- **실시간 추론**: BentoML 기반 고성능 모델 서빙

## 기술 스택
- **Backend**: Python, Flask, FastAPI
- **Machine Learning**: Scikit-learn, LightGBM, XGBoost
- **Causal Inference**: Orthogonalization, Double ML
- **Model Serving**: BentoML, Docker
- **Database**: PostgreSQL
- **Monitoring**: Airflow, Flask Dashboard

## 핵심 기술적 도전과 해결책

### 1. 신뢰할 수 있는 예측 모델 구축
**문제**: 단순한 예측 성능만으로는 선택의 신뢰도를 보장할 수 없음

**해결책**:
- **인과추론 적용**: 교란편향 등 통계적 편향을 제거하여 인과적 관계 기반 예측
- **직교화(Orthogonalization)**: 예측 변수와 교란 변수를 분리하여 편향 제거
- **의학적 직관 반영**: 단조 증가/감소 조건을 만족하는 모델 설계

**결과**: 결정계수(R²) 0.7 달성으로 예측 신뢰도 확보

### 2. 사용자 신뢰도 및 만족도 향상
**문제**: 높은 평가지표가 사용자 신뢰와 만족을 보장하지 않음

**해결책**:
- **도메인 지식 기반 근거 제시**: AI 예측 결과와 함께 의학적 근거 제공
- **사용자 피드백 반영**: 주기적인 피드백 수집 및 UI/리포팅 기능 개선
- **차별화 증명**: 연구 내용을 학술 논문으로 작성하여 제품 차별점 입증

**결과**: 사용자 친화적인 서비스 설계로 신뢰도 향상

### 3. 데이터 품질 및 특성 분석
**문제**: 다양한 소스의 데이터 품질과 일관성 확보

**해결책**:
- **종합적 EDA**: 좌안/우안 차이, 검사 장비 오류, 의사별 차이 등 분석
- **데이터 검증**: OCR 결과, 수기 입력 데이터의 완전성 검증
- **피처 엔지니어링**: 렌즈 회전각도, 종류, 두께 등 도메인 지식 기반 피처 추가

**결과**: 데이터 품질 향상 및 예측 성능 개선

## 모델링 접근법

### 모델링 조건 설정
서비스 목표에 맞는 모델 조건을 다음과 같이 정의했습니다:
1. **단조성 조건**: 특정 변수와 예측값 간의 단조 증가/감소 관계 유지
2. **해석 가능성**: 모델이 해석 가능하거나 결과를 추정할 수 있어야 함

### 모델 선택 및 최적화
- **Linear Regression 계열**: Lasso, Ridge, ElasticNet (회귀 계수로 단조성 확보)
- **GBDT 계열**: LightGBM, XGBoost, CatBoost (monotonic constraint 적용)
- **앙상블**: Voting과 Stacking을 통한 성능 향상
- **하이퍼파라미터 튜닝**: Bayesian optimization 활용

### 일반화 성능 확보
- **Data Leakage 방지**: 시간 기반 test set 구성 및 unknown 처리
- **의학적 논리 검증**: 회귀 계수, feature importance, SHAP 분석을 통한 정성평가
- **정기적 성능 확인**: 특정 주기로만 test set 확인하여 과적합 방지

## 시스템 아키텍처

### 모델 서빙
- **BentoML 활용**: Docker 이미지로 패키징하여 버전 관리
- **온프레미스 배포**: 기존 서버 리소스 활용한 추론 서버 구축

### 데이터 일관성 확보
- **Feature Store 구축**: 학습과 추론에서 동일한 로직으로 데이터 처리
- **FastAPI 기반**: ORM을 활용한 데이터 관리 시스템

### 모니터링 시스템
- **Flask Dashboard**: 모델 성능 및 데이터 분포 실시간 모니터링
- **Airflow 스케줄링**: 정기적인 모니터링 데이터 업데이트

## 현재 연구 및 개선 방향

### 한계점 인식
현재 모델의 성능 한계를 다음과 같이 분석했습니다:
- **측정 한계**: 검사 장비는 홍채 윗부분만 측정 가능
- **구조적 요소**: 실제 렌즈 삽입 위치(섬모체 낭) 정보 부족
- **모델 한계**: Linear/GBDT 모델로는 latent space 구성 어려움

### 향후 연구 방향
- **구조적 요소 추정**: 보이지 않는 해부학적 구조를 추정할 수 있는 모델 개발
- **Latent Space 모델링**: 복잡한 구조적 관계를 학습할 수 있는 고급 모델 연구

## 결과 및 성과
- **예측 신뢰도**: 결정계수(R²) 0.7 달성
- **통계적 편향 제거**: 인과추론 기반 신뢰할 수 있는 예측 제공
- **사용자 만족도**: 도메인 지식 기반 근거 제시로 신뢰도 향상
- **시스템 안정성**: 자동화된 모니터링으로 안정적인 서비스 운영

## 학습한 점
- 인과추론을 통한 예측 모델의 신뢰성 확보 방법
- 의료 분야에서의 AI 시스템 설계 및 검증 방법
- 사용자 중심의 서비스 설계 및 피드백 반영 과정
- 대용량 데이터 처리 및 모델 서빙 시스템 구축