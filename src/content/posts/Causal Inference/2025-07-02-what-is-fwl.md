---
title: "FWL(Frisch-Waugh-Lovell) 정리란?"
date: "2025-07-02"
excerpt: "통계적 편향을 제거하기 위한 방법론"
category: "Causal Inference"
tags: ["Causal Inference"]
---

참고자료

1. 실무로 통하는 인과추론 with python
2. [네이버블로그_ (선형모형) 04 Frisch-Waugh-Lovell 정리](https://blog.naver.com/dillid94/222482368731), 수식 풀이가 잘되어 있음

# 배경 설명

---

인과추론이란 "원인 -> 결과"의 패턴인 "인과관계"를 찾는데에 목적이 있습니다.
이 패턴을 찾는건 어려운 일인데, 그 이유 중 하나는 원인과 결과에 모두 영향을 주는 교란변수 때문입니다.
교란변수(confounding variable)란 종속변수와 독립변수에 모두 영향을 줘 잘못된 인과관계를 찾도록 만드는 변수를 말합니다.

즉 교란변수가 잘못된 패턴을 찾도록 유도하기 때문입니다.

![confounding variable 예시그림](/post/confounding_bias_예시그림.png)

가장 대표적인 예시로 "아이스크림 판매량"과 "상어 어택횟수"를 생각해볼 수 있습니다.
"기온"이라는 변수는 "아이스크림 판매량"과 "상어의 공격횟수"에 모두 영향을 줍니다.

그래서 "기온"이 올라가서 "아이스크림 판매량"이 증가하고 "상어의 공격횟수"가 증가한 것인데, "아이스크림 판매량"이 증가해서 "상어의 공격횟수"가 증가했다는 생각을 하게 됩니다.

즉 "교란 변수"는 변수간의 관계를 잘못 해석할 가능성을 만들게 됩니다.
따라서 변수간의 관계를 볼 땐 교란변수를 제거해주는게 굉장히 중요합니다.
그렇다면 다음과 같은 질문을 해볼 수 있습니다.

> 교란변수를 없애야 한다는 건 이해했어, 그러면 이걸 어떻게 없앨 건데?

가장 좋은 건 교란변수를 파악하고 실험 설계를 통해 없애는 것입니다.
위의 예시에서는 "기온"이라는 교란편수를 파악하고, 이를 통제한 후에 두 변수 간의 관계를 살펴볼 수 있습니다.

하지만 교란변수를 파악하더라도 이를 통제할 수 없을 때가 있습니다.
예를 들어 수술방법(독립변수)과 수술 후 결과(종속변수)의 관계에서는 나이, 생활습관 등의 교란변수가 있습니다.

교란변수를 파악하지만 이를 통제할 수 없습니다.
> 이를 위해 교란변수의 영향을 "통계적"으로 제거해주는 방법이 제안되었습니다.

# FWL Theorem 이란?
---

> 앞서 설명한 교란변수의 영향, 즉 편향을 보정하기 위한 방법입니다.

FWL 정리의 이론적 배경은 다중회귀의 강력함에 있습니다.

> 다중 회귀 분석에서 회귀 계수의 의미는 모델의 다른 변수들의 효과를 고려한 후 얻은 동일 설명변수의 이변량계수다.

이는 다중회귀모형에서 특정 관심 변수의 OLS 추정계수는, (1) 모든 설명변수를 한꺼번에 포함하여 회귀분석한 결과와, (2) 통제 변수들에 대해 종속변수와 관심 변수 각각의 잔차를 구한 뒤 이 잔차들 간에 회귀분석한 결과가 동일하다는 의미입니다.

## 수학적 표현

다중회귀 모델을 다음과 같이 표현할 수 있습니다:

$$Y = \beta_0 + \beta_1 X_1 + \beta_2 X_2 + \cdots + \beta_k X_k + \epsilon$$

여기서 $Y$는 종속변수, $X_1$은 관심 변수, $X_2, \ldots, X_k$는 통제 변수들입니다.

FWL 정리에 따르면, $\beta_1$의 OLS 추정치는 다음 두 방법으로 동일하게 구할 수 있습니다:

### 방법 1: 전체 모델에서 직접 추정
$$\hat{\beta}_1 = \frac{\text{Cov}(X_1, Y)}{\text{Var}(X_1)}$$

### 방법 2: 잔차화를 통한 추정
1. $Y$를 $X_2, \ldots, X_k$에 대해 회귀하여 잔차 $e_Y$ 계산
2. $X_1$을 $X_2, \ldots, X_k$에 대해 회귀하여 잔차 $e_{X_1}$ 계산
3. $e_Y$를 $e_{X_1}$에 대해 회귀하여 $\hat{\beta}_1$ 추정

$$e_Y = Y - \hat{Y}_{X_2,\ldots,X_k}$$
$$e_{X_1} = X_1 - \hat{X_1}_{X_2,\ldots,X_k}$$
$$\hat{\beta}_1 = \frac{\text{Cov}(e_{X_1}, e_Y)}{\text{Var}(e_{X_1})}$$

실제로 수식적으로도 같고 (참고자료 2 참고) 테스트를 해봐도 같습니다.

인과추론에서 다중회귀는 예측 모델이 아닌 인과관계를 찾는 모델로 사용됩니다.

# R-learner, 인과추론 모델로 구현하기
---

정리하면 FWL이란 잔차화를 통해 교란변수를 직교화 시키는 방법입니다.

FWL을 meta learner 형태로 구현한게 R-learner입니다.
따라서 잔차화를 위한 2개의 nuisance function이 필요하고, CATE를 추정하는 모델이 필요합니다.

R-learner의 목적 함수는 다음과 같습니다:

$$\mathcal{L}(\tau) = \mathbb{E}\left[\left(Y - m(X) - \tau(X)(T - e(X))\right)^2\right]$$

여기서:
- $m(X) = \mathbb{E}[Y|X]$: 결과 모델 (outcome model)
- $e(X) = \mathbb{E}[T|X]$: 처리 모델 (treatment model)
- $\tau(X)$: 조건부 평균 처리 효과 (CATE)

다중회귀와 비교해서 FWL은 meta leaner로 구현할 때의 장점은 '비선형적인 패턴'을 학습할 수 있다는 점입니다.

이렇게 구현된 R-learner를 통해 CATE(Conditional Average Treatment Effect)를 추정할 수 있습니다.