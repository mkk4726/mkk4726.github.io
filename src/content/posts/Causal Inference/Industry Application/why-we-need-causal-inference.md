---
title: "인과 추론 도입배경"
date: "2025-07-14"
excerpt: "인과추론을 왜 사용해야하는지 설명하고 이를 도입하기 위해 설득하는 글"
category: "Causal Inference"
tags: ["ICL-Lenze-sizing"]
---

# 0. Abstract - 배경, 요약
---

환자에게 렌즈 삽입술을 위한 최적의 렌즈 사이즈를 추천하는, 렌즈 사이징 문제는 예측 모델을 고도화하는 방향으로 연구가 진행되어왔다. 
환자의 눈의 조건과 삽입한 렌즈 사이즈를 입력 받아 수술결과(vaulting, 렌즈 후면과 수정체 전면까지의 거리)를 예측하는 모델을 개발하고, 이 모델의 예측값을 통해 최적의 렌즈 사이즈를 제안하는 방식이다. 하지만 기존 예측 모델은 한계점이 존재한다.
이번 보고서를 통해 기존 예측 모델의 한계점을 분석하고 이를 해결하기 위한 방법을 제안한다.

기존 예측 모델의 한계점을 요약하면 렌즈 사이즈가 결과에 영향을 주는 인과적인 영향도를 추정하지 못하며, 단순히 예측 평가지표만을 고려하고 있어 추천의 신뢰도를 보장하지 못한다는 것이다.
이러한 한계점을 극복하기 위해 인과추론 방법론을 도입할 것을 제안한다.
이때 기대되는 효과는 다음과 같다. 개인화된 처치 효과를 추정할 수 있고 이를 통해 개인화된 최적의 렌즈 사이즈를 제안할 수 있다. 그리고 측정되지 않은 데이터에 대한 평가를 고려하여 추천의 신뢰도를 보장할 수 있다.


# 1. Introduction - 기존 연구의 한계점 분석
---

렌즈 삽입술을 위한 최적의 렌즈 사이즈를 찾는 일은 의사의 높은 수준의 경험과 노하우에 의존하는 일이다. 이를 도와주기 위해 최적의 렌즈 사이즈를 추천하는 모델이 개발되어왔다.
기존의 최적의 사이즈를 찾기 위한 렌즈 사이징 문제는 예측 모델을 고도화하는 방향으로 연구가 진행되어왔다.
환자의 눈의 조건과 삽입한 렌즈 사이즈를 입력 받아 수술결과(vaulting, 렌즈 후면과 수정체 전면까지의 거리)를 예측하는 모델의 성능을 향상시키는 방향을 진행되었다.
대표적으로 MAE와 같이 실제 값과 예측값의 차이를 평가하는 예측평가지표를 통해 모델의 성능을 평가하고 이를 개선하는 방향으로 연구가 진행되었다.
*MAE: Mean Absolute Error, 실제 값과 예측값의 차이의 절대값의 평균*

하지만 예측 모델 기반의 렌즈 사이징 모델인 기존 연구는 분명한 한계점이 존재한다.
먼저 이를 이해하기 위해서는 예측 문제와 선택의 문제를 이해하고 구분해야 한다.

## 1.1 예측 문제와 선택의 문제 차이
---

예측 문제와 선택의 문제는 근본적으로 다른 성격을 가진다.
먼저 예측 문제는 주어진 입력에 대해 결과를 예측하는 문제를 말한다.
예를 들어 "환자 A가 12.6mm 렌즈로 수술을 받으면 vaulting이 얼마가 될까?"와 같은 문제가 예측 문제에 해당한다.
예측 문제의 목표는 정확한 예측이다. 예측 문제의 성능 지표는 MAE, RMSE, R² 등이 있다.

선택의 문제는 여러 옵션 중 최적의 선택을 하는 문제를 말한다.
예를 들어 "환자 A에게 12.1mm, 12.6mm, 13.2mm 중 어떤 렌즈를 추천할까?"와 같은 문제가 선택의 문제에 해당한다.
선택 문제의 목표는 최적의 선택이다.
선택 문제의 성능 지표는 처치 효과, 개인화된 추천 정확도 등이 있다.

예측 문제와 선택 문제의 가장 큰 차이점은 통제 변수(Control Variable)의 존재 여부이다.
통제 변수는 연구자가 직접 조작할 수 있는 변수로, 실험 설계에서 핵심적인 역할을 한다. 이는 인과추론에서 처치(Treatment)와 동일한 개념으로, 연구자가 의도적으로 변화시킬 수 있는 독립변수를 의미한다. 렌즈 사이징 문제에서는 렌즈의 사이즈가 처치에 해당하며 처치가 결과에 미치는 영향을 처치효과라고 한다.

예측 문제에서는 모든 입력 변수가 주어진 값으로 고정되어 있다. 즉, 모델의 목표는 주어진 조건 하에서 결과를 정확히 예측하는 것이다. 예를 들어, "환자 A가 12.6mm 렌즈로 수술을 받으면 vaulting이 얼마가 될까?"라는 질문에서 렌즈 사이즈(12.6mm)는 이미 결정된 고정값이며, 이를 변경할 수 없다. 이 경우 모델은 환자의 눈 조건과 고정된 렌즈 사이즈를 입력으로 받아 vaulting 값을 예측하는 함수를 학습한다.
선택 문제에서는 통제 변수가 핵심 역할을 한다. 연구자는 여러 옵션 중에서 최적의 선택을 하기 위해 통제 변수의 값을 변화시킬 수 있다. "환자 A에게 12.1mm, 12.6mm, 13.2mm 중 어떤 렌즈를 추천할까?"라는 질문에서 렌즈 사이즈는 통제 변수로, 여러 옵션 중에서 선택할 수 있는 변수이다. 이 경우 모델은 각 렌즈 사이즈 옵션에 대한 결과를 예측하고, 최적의 선택을 제안하는 함수를 학습해야 한다.

예측 문제는 조건부 확률 $P(Y|X)$를 추정하는 문제이고, 선택 문제는 조건부 평균 처치 효과 $E[Y(T=t)|X]$를 추정하는 문제이다. 여기서 $T$는 통제 변수(처치)를, $X$는 환자 특성을, $Y$는 결과를 나타낸다.
조건부 평균 처치 효과란 통제 변수가 주어졌을 때 처치 효과의 평균을 의미한다.

렌즈 사이징은 본질적으로 선택의 문제이다. 환자에게 최적의 렌즈를 추천하는 것이 목표이기 때문이다. 하지만 기존 연구는 예측 모델의 성능 향상에만 집중하여 선택의 문제를 제대로 해결하지 못한다.


## 1.2 예측 모델이 선택의 문제에 활용되기 어려운 이유
---

렌즈 사이징이 선택의 문제임을 확인했으므로, 이제 예측 모델이 선택의 문제에 활용되기 어려운 이유를 분석한다.
예측 모델이 가지는 한계점은 무엇인지, 이를 기반으로 선택을 할 때의 위험성에 대해 이야기한다.

### 1.2.1 상관관계에 기반한 예측 모델의 한계

예측 모델은 주어진 데이터에서 변수 간의 동시 변동 패턴, 즉 상관관계를 학습하여 결과를 예측한다. 상관관계는 두 변수 사이에 일정한 패턴이나 동반 변동이 존재함을 의미하며, 한 변수가 커질 때 다른 변수가 일정하게 커지거나 작아지는 경향을 보이는 통계적 관계를 말한다. 예측 모델은 상관관계만을 학습하므로 숨겨진 교란변수(Confounding Variable)의 존재를 인식하지 못한다. 

*교란변수(Confounding Variable) : 처치(Treatment)와 결과(Outcome) 모두에 영향을 미치는 제3의 변수로, 처치와 결과 사이의 인과관계를 왜곡시키는 변수를 의미한다. 교란변수는 처치 선택과 결과에 동시에 영향을 주어 가짜 인과관계를 만들어내거나 실제 인과관계를 숨길 수 있다.*
*교란편향(Confounding Bias) : 교란변수로 인해 발생하는 통계적 편향으로, 처치와 결과 사이의 실제 인과관계가 왜곡되어 나타나는 현상을 의미한다. 이는 처치 그룹 간에 교란변수의 분포가 다를 때 발생하며, 처치 효과의 정확한 추정을 방해한다.*

예를 들어, 숙박 가격과 매출 데이터에서 가격이 높을수록 매출이 높아 보이는 패턴이 관찰되면, 예측 모델은 "가격을 올리면 매출이 오른다"고 결론을 내린다. 하지만 이 패턴 뒤에는 성수기/비수기 여부라는 숨겨진 교란변수가 존재할 수 있다. 실제로는 성수기에 가격과 매출이 동시에 상승하고, 비수기에 가격과 매출이 동시에 하락하는 것이며, 가격과 매출 사이에는 직접적인 인과관계가 없다. 이러한 상관관계를 인과관계로 오해하면 "매출을 올리려면 가격을 올려야 한다"는 잘못된 결론에 이를 수 있고, 실제 효과가 있는 개입(예: 비수기 프로모션) 대신 부적절한 가격 정책을 선택하게 만든다. 
*인과관계: 한 변수가 변할 때 다른 변수가 그 변화에 의해 직접적·체계적으로 영향을 받아 변화하는 관계를 의미*

예측 모델의 예측 성능이 좋다고 해서 인과관계를 잘 찾았다는 보장이 없으며, 렌즈 사이징과 같은 선택 문제에서는 인과관계가 필요하지만 예측 모델은 이를 제공하지 못한다. 따라서 예측 모델에 기반해 선택을 하는 것은 위험하며, 인과관계를 직접적으로 추론할 수 있는 방법론이 필요하다.
인과관계를 직접적으로 추정하는 모델을 통해 처치 (통제변수, 렌즈사이즈)가 결과에 미치는 영향을 직접적으로 추정할 수 있고 이를 통해 올바른 선택을 할 수 있다.

### 1.2.2 데이터 안에 존재하는 통계적 편향

앞서 언급한 것처럼 데이터에 통계적 편향(교란편향)이 존재하면 예측 모델은 잘못된 패턴, 즉 인과관계가 아닌 패턴을 학습할 수 있다. 렌즈 사이징 문제에서 데이터는 통계적 편향을 가지고 있다. 이는 렌즈 크기별(처치별)로 환자의 분포가 다르다는 의미이며, 데이터에서 확인된다. 

<figure>
  <img src="/post/what-is-statistical-bias/처치별_Feature_DensityPlot.png" alt="처치별 Feature Density Plot">
  <figcaption>그림 1: 처치별 환자 눈의 크기 분포 비교</figcaption>
</figure>

그림 1은 처치(렌즈 사이즈)별로 환자의 눈 크기에 대한 분포를 시각화한 것이다. 그림 1에서 볼 수 있듯이, 처치별로 환자의 눈 크기 분포(ATA, ACD)가 명확히 다르다. 이는 의사가 환자의 개별 특성을 고려하여 적절한 렌즈를 선택하는 임상적 판단에 따른 결과이다. 예를 들어, 눈이 작은 환자에게는 작은 렌즈를, 눈이 큰 환자에게는 큰 렌즈를 선택하는 경향이 있다.
이러한 선택 편향은 교란편향을 유발한다. 환자의 눈 크기, 나이, 각막 두께 등은 렌즈 선택과 수술 결과 모두에 영향을 미치는 교란변수이기 때문이다. 
앞서 1.2.1에서 언급한 바와 같이, 데이터에 통계적 편향이 존재할 경우 예측 모델은 인과관계가 아닌 잘못된 패턴을 학습할 수 있으며, 이러한 패턴에 기반한 선택은 위험하다.

또한 통계적 편향은 렌즈의 크기가 결과에 미치는 영향인 처치효과를 왜곡한다.
렌즈 사이즈별로 환자 눈의 분포가 다르기 때문에 단순히 결과만 비교해서는 렌즈 사이즈의 효과를 알 수 없다. 환자의 개별 특성을 동일하게 맞춘 상태에서 렌즈 효과를 비교해야 한다. 이는 실험을 설계할 때 대조군과 처치군을 동일하게 맞춰야 하는 것과 같다. 대조군과 실험군을 동일하게 맞춰야만 실험 조건만의 영향을 추정할 수 있기 때문이다.
하지만 처치효과를 추정하기 위해 무작위 대조 실험(RCT, Randomized Controlled Trial)을 진행할 수 없다.
*무작위 대조 실험 : 대조군과 실험군을 무작위로 선택하여 실험을 진행하는 방법*
따라서 처치 효과를 추정하기 위해서는 통계적 편향을 제거하고 인과관계를 직접적으로 추론해야 한다. 인과추론 방법론은 이러한 교란편향을 통계적으로 제거하여 실제 처치 효과를 추정할 수 있는 방법을 제공한다. 구체적인 방법은 다음 섹션에서 다룬다.


## 1.3 예측 평가지표의 한계
---

예측 모델의 또 다른 한계는 측정되지 않은 데이터(반사실, Counterfactual)에 대한 평가를 고려하지 않는다는 점이다. 기존 연구들은 예측 모델을 고도화하는 방향으로 진행되었으며, 예측 성능지표를 통해 모델의 신뢰도를 보장하고 있다. 하지만 최적의 렌즈를 추천하기 위해서는 수술받은 렌즈 외에 다른 렌즈 크기에 대한 결과도 예측해야 한다. 예측 모델의 한계는 실제로 일어나지 않은 상황에 대한 평가가 불가능하다는 점이다.

예를 들어, 환자 A가 12.6mm 렌즈로 수술을 받고 이에 결과를 얻었다고 가정한다. 이때 추천 모델이 증명해야 하는 것은 "만약 이 환자가 13.2mm 렌즈로 수술을 받았다면 어떤 결과가 나왔을까?"이다. 하지만 이 환자는 이미 12.6mm 렌즈로 수술을 받았기 때문에, 13.2mm 렌즈의 결과는 알 수 없다. 이렇게 실제로는 관찰되지 않은 가상의 상황을 "반사실(Counterfactual)"이라고 한다. 기존 예측 모델들은 관찰된 데이터만으로 학습하기 때문에, 이런 반사실적 상황에 대한 추정이 불가능하다. 그리고 이에 대한 평가지표를 고려하지 않는다. 

인과추론은 이런 반사실적 상황을 통계적으로 추정할 수 있는 방법론을 제공하며, 이에 대한 평가지표도 함께 고려해 신뢰도를 확보한다.


# 2. Method & Result - 인과추론에 대한 소개와 인과추론을 통해 이를 해결한 방법 소개
---

앞서 언급한 것처럼 선택의 문제에서 예측 모델은 한계점을 가진다. 이를 극복하기 위해 인과추론 방법론을 도입하고자 한다.
인과추론이란 의학, 마케팅, 교육 등에서 자주 사용되는 방법론으로 정책 및 비즈니스에 수반된 수많은 의사결정들의 원인과 결과를 분석하는 방법이다. 인과추론은 인과관계를 분석하고 처치 효과를 추정하여 의사결정을 돕는 방법론이다.
예를 들어 정밀의학에서는 환자별 처치 효과를 추정하여 수술방법을 선택을 결정하고, 교육에서는 학생별 처치 효과를 추정하여 교육 방법을 결정하고, 온라인 마케팅에서는 사용자별 처치 효과를 추정하여 맞춤형 광고를 제공하고, 오프라인 정책 평가에서는 지역별 처치 효과를 추정하여 정책을 결정할 수 있다.
여기서 처치란 인과추론에서 의사결정의 대상(예: 수술 방법, 약물 투여, 교육정책 등)을 의미한다.
렌즈 사이징 문제에서는 렌즈 사이즈가 처치에 해당한다. 인과추론을 통해 렌즈의 사이즈와 결과의 인과관계를 분석하고 처치효과를 추정할 수 있다. 그리고 이를 통해 최적의 렌즈 사이즈를 결정하는데 도움을 줄 수 있다.

인과추론을 도입함으로써 다음과 같은 효과를 기대할 수 있다. 첫째, 통계적 편향을 제거하고 인과관계를 직접적으로 추론할 수 있어 렌즈 크기가 결과에 미치는 실제 영향을 정확히 추정할 수 있다. 둘째, 측정되지 않은 데이터(반사실적 상황)에 대한 평가를 고려하여 모델의 신뢰도를 확보할 수 있다. 셋째, 개인화된 처치 효과(Heterogeneous Treatment Effects)를 추정하여 환자별로 최적화된 렌즈 사이즈를 제안할 수 있다.
이번 보고서에서는 통계적 편향을 제거한 결과에 대해서만 소개하며, 개인화된 처치 효과를 추정하여 개인화된 추천을 하는 방법에 대해서는 추후에 다루도록 한다.

## 2.1 인과추론 방법을 통해 통계적 편향을 제거

렌즈 사이즈가 결과에 미치는 영향인 처치효과를 추정하기 위해서는 대조군과 실험군처럼 렌즈 사이즈를 제외한 나머지 변수는 통제해야 한다.
즉 렌즈 사이즈별로 환자의 눈의 크기에 대한 분포가 같아야 한다. 하지만 앞서 확인한 것처럼 데이터에는 편향이 존재하며, 처치효과를 추정하기 위해 RCT를 수행할 수 없다. 
이때 인과추론 방법론을 통해 통계적 편향을 제거할 수 있다.

<figure>
  <img src="/post/what-is-statistical-bias/처치별결과비교.png" alt="처치별 결과 비교">
  <figcaption>그림 2: 처치별 결과 분포 비교</figcaption>
</figure>

그림 2는 처치별 결과의 분포를 시각화한 것이다. 앞서 설명한 것처럼 처치별로 환자의 눈의 분포가 다르기 때문에 처치별 분포를 비교해 처치효과를 추정할 수 없다.
처치효과를 추정하기 위해서는 통계적 편향을 제거해야 한다.

<figure>
  <img src="/post/what-is-statistical-bias/사이즈별잔차분포.png" alt="결과에서 교란변수에 대한 영향 제거후 분포">
  <figcaption>그림 3: 잔차화를 통해 통계적 편향을 제거한 결과 분포</figcaption>
</figure>

그림 3은 그림 2의 결과에서 잔차화를 통해 통계적 편향을 제거한 것이다. 잔차화란 결과(vaulting)에 렌즈 사이즈를 제외한 다른 변수(교란변수)가 미치는 영향을 제거해 교란변수를 통제한 것과 같은 효과를 만드는 방법론이다. 잔차화를 통해 통계적 편향을 제거하면 렌즈 사이즈별로 환자의 눈의 분포가 같아지므로 렌즈 사이즈가 결과에 미치는 영향을 추정할 수 있다.

이처럼 인과추론 방법론은 데이터가 가지고 있는 통계적 편향을 확인하고 이를 제거해 처치의 효과를 추정하고 인과적인 관계를 추론하는 방법론이다.

# 3. Conclusion - 연구 요약 및 향후 계획
---

본 연구에서는 렌즈 사이징 문제에서 기존 예측 모델의 한계점을 분석하고, 이를 해결하기 위한 인과추론 방법론의 도입을 제안하였다. 기존 예측 모델은 선택의 문제에서 통계적 편향을 고려하지 못하고 인과관계를 직접적으로 추론하지 못하는 한계를 가지고 있다. 이러한 한계를 극복하기 위해 인과추론 방법론을 도입하여 통계적 편향을 제거하고 처치 효과를 추정하는 방법을 제시하였다.

인과추론 방법론의 도입을 통해 다음과 같은 효과를 기대할 수 있다. 첫째, 통계적 편향을 제거하여 렌즈 크기가 결과에 미치는 실제 인과적 영향을 정확히 추정할 수 있다. 둘째, 측정되지 않은 데이터(반사실적 상황)에 대한 평가를 고려하여 모델의 신뢰도를 확보할 수 있다. 셋째, 개인화된 처치 효과(Heterogeneous Treatment Effects)를 추정하여 환자별로 최적화된 렌즈 사이즈를 제안할 수 있다.

향후 연구에서는 개인화된 처치 효과 추정을 통한 개인화된 추천 시스템 개발에 집중할 예정이다. 이를 통해 환자별 특성을 고려한 맞춤형 렌즈 사이즈 추천이 가능한 모델을 구축하고자 한다.
