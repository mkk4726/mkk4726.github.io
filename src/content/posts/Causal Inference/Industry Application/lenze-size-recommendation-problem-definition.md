---
title: "렌즈 사이즈 추천 문제에서 문제 정의에 대한 고민"
date: "2025-08-04"
excerpt: "렌즈 사이즈 추천에서 인과추론을 도입할 때 문제 정의를 어떻게 할 것인가"
category: "Causal Inference"
tags: ["problem definition"]
---

렌즈 삽입술에서 Y는 vault로 정의가 됨 (지금 풀려고 하는 문제에서는).
vault는 렌즈 삽입술 후에 측정되는 값으로, 렌즈 후면과 수정체 전면까지의 거리를 의미함.

여기서 고민사항은 $T=0$인 것을 어떻게 정의해야하는지.

# $T=0$ 인 상황은 무엇일까?
---

## 1. 수술 받기 전 상태

수술(처치) 받기 전 상태라고 정의하게 되면 vault값이 존재하지 않는다.
왜냐하면 vault의 정의 자체가 렌즈 후면과 수정체 전면까지의 거리라서.

존재하지 않는 값이지만 계산을 위해 0으로 정의해놔도 괜찮을까?
$\text{vault} = Y(T=0, X=x) = 0$

## 2. 가장 작은 크기의 렌즈를 받은 상태

현재 삽입하는 렌즈 크기에는 [12.1, 12.6, 13.2]가 있다.
이때 가장 작은 렌즈를 삽입한 상태를 $T=0$ 처치를 받은 상태로 정의해도 될까?

$Y(T=0, X=x) = Y(T=12.1, X=x)$

### 인과추론에서 T=0 의 정의가 뭐지?

> 처치(treatment)가 적용되기 전의 시점, 즉 control 상태.

- T=0: 처치가 시작되기 직전의 시점 (baseline), 대조군에 해당하는 값
- T=1: 처치가 적용된 후의 시점 (post-treatment)

예를 들어:
- 의약품 효과 연구: 약을 먹기 전(T=0)과 약을 먹은 후(T=1)의 건강 상태 비교
- 교육 프로그램 평가: 프로그램 참여 전(T=0)과 참여 후(T=1)의 성적 비교
- 마케팅 캠페인: 캠페인 시작 전(T=0)과 시작 후(T=1)의 매출 비교

대조군(control group)과 처치군(treatment group)의 개념처럼 어떤 처치의 효과를 추정하려고 할 때 비교대상이 되는 값.

이 개념에 따르면 2번 정의는 말이 안된다.

하지만 이렇게 정의해보는 건 어떨까?

> 처치효과는 가장 작은 렌즈 대비 렌즈의 크기가 결과에 미치는 효과 혹은 영향도




### 처치를 받기 전에 Y값이 없는 경우는 어떻게 하지? (정의가 안될 떄)

AI랑 ideation 해보면서 나온 것들 정리.

1. 대안적 결과 변수 정의:
- vault 대신 다른 결과 변수 사용: 수술 전후 모두 측정 가능한 변수
  - 예: 시력 개선도, 안압 변화, 환자 만족도 등
- vault의 변화율: 수술 전후 vault 변화량을 결과 변수로 사용

2. T=12.1mm 렌즈를 기준(control)으로 정의 — 상대 비교:
- 완전 무처치는 존재하지 않음 -> 최소 크기 렌즈를 기준점으로 설정: 
  - $T=12.1$을 기준으로 $CATE(T=t, X=x) = E[Y|T=t, X=x] - E[Y|T=12.1, X=x]$
  - 이는 "최소 크기 대비 다른 크기의 효과"를 측정
- 렌즈 크기 자체가 treatment level인 multi-valued treatment setting
  - $T \in {12.1, 12.6, 13.2}$
  - 기준점: $T_0 = 12.1$
- 이전 렌즈 대비 개선도: 환자가 이전에 사용하던 렌즈 대비 개선 효과
- 장점: 인과추론의 틀에서 정의 가능한 treatment comparison
- 단점: 절대값이 아닌 상대값만 추정 가능하며, baseline vault가 "충분히 작은가?"에 대한 해석적 고민 필요

3. Vault를 0으로 정의 — "절대 효과로 바꾸기":
- vault = 0 가정: 수술 전 vault를 0으로 가정
  - $CATE(T=t, X=x) = E[Y|T=t, X=x] - 0 = E[Y|T=t, X=x]$
  - 이는 "절대적 vault 효과"를 측정
- CATE가 아닌 ATE와 유사한 구조로 해석됨
  - 특정 렌즈를 넣었을 때 vault값이 얼마나 나오는지를 절대적 관점에서 해석


🧠 결론 및 제안
임상 현실 + 인과추론 이론을 동시에 고려할 때, 가장 자연스러운 정의는:

$T=12.1$mm 렌즈를 기준으로 상대적 효과(CATE)를 정의하고,
절대효과(=vault 값 자체)는 최적화 목적의 타겟으로 사용

- 인과추론: $CATE(T=t, X=x) = E[Y|T=t, X=x] - E[Y|T=12.1, X=x]$
- 추천 목적: $\arg\max_t E[Y|T=t, X=x]$


# 측정하지 않은 값에 대한 예측값은 어떻게 평가할 것인가
---
<figure>
<img src="/post/Causal_Inference/렌즈추천_평가고민.jpeg" alt="how-to-evalutate-counterfactual" />
<figcaption>그림1. 측정하지 않은 값에 대한 예측값은 어떻게 평가할 것인가</figcaption>
</figure>

내가 생각하는 문제는 결국 그림1과 같은 상황이다.
3가지의 렌즈 크기 중 고객은 하나에 대해서 수술을 받게 되는데, 그러면 나머지 2개에 대한 결과값이 없는 상황에서, 예측모델의 성능은 어떻게 판단할 수 있을까?

여기서 사용되는 개념이 양수성 (positivity).
이는 $ 0 < P(T=t | X=x) < 1$ 을 만족하는 것을 의미함.
즉 어떤 고객이 각 처치를 받을 확률이 0보다 크다는 것. 
따라서 A는 12.1을 받았지만, A랑 비슷한 다른 고객은 12.6을 받았기 때문에 성능을 확인해볼 수 있다는 것.

처치 간의 분포가 겹쳐있으면 반사실에 대해서도 어느정도 추정이 가능하다.

> 이는 "비슷한 고객들이 다양한 처치를 받았는가?"라는 질문과 직결됨.

## $P(T=t | X=x)$로 모델의 신뢰도를 정의하는 법

직관적으로 생각해보면 P(T=12.1 | X)가 낮다면 해당 고객 같은 경우에는 12.1을 받을 확률이 낮으니까, 12.1에 대한 예측값의 신뢰도가 낮을 것이다.
이를 수학적으로 정의할 수 있을까?






