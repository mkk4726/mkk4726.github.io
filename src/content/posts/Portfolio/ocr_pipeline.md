---
title: "OCR Pipeline System"
description: "문서 이미지에서 텍스트를 추출하는 자동화된 OCR 파이프라인"
technologies: ["Python", "OCR", "Computer Vision", "Docker", "gRPC"]
github: "https://github.com/mkk4726/ocr-pipeline"
demo: "https://ocr-pipeline-demo.example.com"
date: "2024-10-20"
---

# OCR Pipeline System

## 프로젝트 개요
병원 검사 결과 이미지에서 실시간으로 데이터를 추출하여 DB에 자동 적재하는 OCR 파이프라인 시스템을 구축했습니다. 기존 수작업으로 진행되던 데이터 입력 과정을 자동화하여 검안사의 업무 효율성을 크게 향상시켰습니다.

## 주요 기능
- **실시간 OCR 처리**: 검사 완료 즉시 이미지에서 데이터 추출
- **고정 이미지 최적화**: 검사 장비별 고정된 이미지 구조 활용
- **다중 OCR 엔진**: TrOCR 기반 고정밀 텍스트 인식
- **자동 모니터링**: Slack 기반 실시간 에러 알림 및 작업 요약
- **안정적 파이프라인**: 1% 미만 에러율의 안정적인 서비스 운영

## 기술 스택
- **OCR Engine**: TrOCR (Microsoft)
- **Image Processing**: OpenCV, PIL
- **Backend**: Python, gRPC, FastAPI
- **Model Serving**: Triton Server
- **Containerization**: Docker
- **Monitoring**: Slack API
- **Database**: PostgreSQL

## 핵심 기술적 도전과 해결책

### 1. OCR 정확도 99% 달성
**문제**: 검사 결과의 정확성이 매우 중요하므로 높은 OCR 정확도 필요

**해결책**:
- **고정 이미지 구조 활용**: 검사 장비별 고정된 이미지 레이아웃을 활용하여 Text Detection 단계 생략
- **TrOCR 모델 적용**: Text Recognition에 특화된 TrOCR 모델 사용으로 정확도 향상
- **이미지 전처리**: 노이즈 제거, 대비 개선 등 전처리 과정 최적화
- **결과 후처리**: OCR 결과 정제 및 검증 로직 구현

**결과**: OCR 정확도 99% 달성

### 2. 안정적인 파이프라인 구축
**문제**: 실시간 데이터 추출을 위한 안정적인 서비스 운영 필요

**해결책**:
- **객체 지향 설계**: 각 기능을 담당하는 객체들로 파이프라인 구성
- **단계별 에러 처리**: 이미지 송수신, 전처리, OCR, 후처리, DB 적재 각 단계별 명확한 에러 처리
- **비동기 처리**: 1초 이내 응답을 위한 비동기 처리 구조 구현
- **자동 모니터링**: 각 객체별 모니터링 자동화

**결과**: 에러율 1% 미만의 안정적인 파이프라인 구축

### 3. 기존 프로세스 방해 최소화
**문제**: 검안사의 기존 업무 프로세스에 변화를 주지 않으면서 OCR 서비스 추가

**해결책**:
- **Client-Server 구조**: 병원 컴퓨터의 client가 이미지를 전송 후 기존 "아이리더" 프로그램에 자동 적재
- **gRPC 통신**: 빠른 이미지 전송을 위한 gRPC 프로토콜 사용
- **권한 문제 해결**: 다양한 병원 환경에 맞는 배포 방식 (Python/Go)
- **응답 속도 최적화**: 1초 이내 응답으로 기존 프로세스 지연 최소화

**결과**: 기존 프로세스에 방해 없이 OCR 서비스 성공적 통합

## 시스템 아키텍처

### Client 프로그램
- **목적**: 기존 프로세스 방해 없이 OCR 서버로 이미지 전송
- **기술**: gRPC를 통한 고속 이미지 전송
- **환경 대응**: 다양한 병원 컴퓨터 환경에 맞는 배포 (Python/Go)
- **자동화**: 이미지 전송 후 기존 "아이리더" 프로그램에 자동 적재

### OCR Server
- **비동기 처리**: 이미지 수신 즉시 응답 후 백그라운드에서 OCR 처리
- **모델 서빙**: Triton Server를 통한 TrOCR 모델 고성능 서빙
- **GPU 활용**: 온프레미스 GPU 서버를 통한 고속 추론
- **고정 이미지 처리**: 검사 장비별 pixel 기반 조건문으로 Text Detection 생략

### 모니터링 시스템
- **Slack 알림**: 에러 발생 시 실시간 알림
- **작업 요약**: 하루 작업량 및 성공률 자동 보고
- **객체별 모니터링**: 각 기능별 독립적인 모니터링
- **로그 관리**: 깔끔한 로그 구조로 쉬운 문제 진단

## 핵심 최적화 포인트

### 1. Text Detection 생략
검사 결과 이미지가 고정된 구조를 가지고 있다는 특성을 활용:
- 검사 장비별 이미지 버전 및 페이지 구분
- Pixel 값 기반 조건문으로 영역 분할
- Text Recognition 단계에만 집중하여 처리 속도 향상

### 2. TrOCR 모델 선택
다양한 OCR 모델 비교 후 TrOCR 선택:
- **정확도**: 벤치마크에서 98% 정확도
- **실제 성능**: 숫자 인식 100% 정확도
- **한국어 지원**: 문자 인식은 단위 정보로 고정 위치 활용

### 3. 비동기 처리 구조
사용자 경험을 위한 응답 속도 최적화:
- 이미지 수신 즉시 응답 (1초 이내)
- 백그라운드에서 OCR 처리
- 상담 시점까지 충분한 처리 시간 확보

## 결과 및 성과
- **OCR 정확도**: 99% 달성
- **에러율**: 1% 미만의 안정적인 파이프라인 구축
- **처리 속도**: 1초 이내 응답으로 기존 프로세스 지연 최소화
- **유지보수 효율**: 코드 구조 개선으로 유지보수 효율 10배 증가
- **모니터링 비용**: 자동화를 통한 모니터링 시간 90% 감소

## 학습한 점
- 고정 이미지 구조를 활용한 OCR 최적화 방법
- 실시간 데이터 처리 파이프라인의 안정성 확보 방법
- 기존 프로세스와의 통합 시 사용자 경험 고려의 중요성
- 객체 지향 설계를 통한 유지보수성 향상
- 자동화된 모니터링 시스템의 구축 및 운영 방법